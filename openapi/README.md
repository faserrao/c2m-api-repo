# OpenAPI Directory

This directory contains the OpenAPI specifications generated from the EBNF data dictionary and enhanced with authentication overlays.

## Directory Structure

```
openapi/
├── c2mapiv2-openapi-spec-base.yaml         # Base spec from EBNF conversion
├── c2mapiv2-openapi-spec-final.yaml        # Final spec with overlays applied
├── c2mapiv2-openapi-spec-final-with-examples.yaml  # Final spec with example data
├── bundled.yaml                            # Bundled specification (all refs resolved)
└── overlays/                               # OpenAPI overlays
    └── auth.tokens.yaml                    # JWT authentication overlay
```

## File Descriptions

### Core Specifications

#### `c2mapiv2-openapi-spec-base.yaml`
The initial OpenAPI specification generated directly from the EBNF data dictionary.
- **Generated by**: `scripts/ebnf_to_openapi_dynamic_v3.py`
- **Updated via**: `make generate-openapi-spec-from-ebnf-dd`
- **Purpose**: Raw conversion output before enhancements

#### `c2mapiv2-openapi-spec-final.yaml`
The complete OpenAPI specification with all overlays applied.
- **Purpose**: Production-ready API specification
- **Includes**: Authentication, security schemes, enhanced metadata
- **Used by**: Postman collection generation, SDK generation, documentation

#### `c2mapiv2-openapi-spec-final-with-examples.yaml`
Final specification enhanced with request/response examples.
- **Purpose**: Documentation and testing
- **Includes**: All features of final spec plus example payloads
- **Used by**: Interactive documentation, mock servers

#### `bundled.yaml`
Single-file version with all external references resolved.
- **Purpose**: Simplified distribution
- **Format**: All $ref links resolved inline
- **Use case**: Third-party tools that don't support references

### Overlays Directory

#### `overlays/auth.tokens.yaml`
OpenAPI 3.1 overlay that adds JWT authentication endpoints and security schemes.
- **Adds**: `/auth/tokens/*` endpoints
- **Security**: Bearer token authentication
- **Applied by**: Build process during spec generation

## Specification Versions

- **OpenAPI Version**: 3.0.0
- **API Version**: 2.0.0
- **Base URL**: `https://api.c2m.com/v2`

## Build Process

1. EBNF → Base spec: `ebnf_to_openapi_dynamic_v3.py`
2. Base spec + Overlays → Final spec: Makefile orchestration
3. Final spec → Examples: Test data injection
4. Final spec → Bundled: Reference resolution

## Making Changes

### To modify data models:
1. Edit `data_dictionary/c2mapiv2-dd.ebnf`
2. Run `make generate-openapi-spec-from-ebnf-dd`

### To modify authentication:
1. Edit `overlays/auth.tokens.yaml`
2. Run `make generate-openapi-spec-from-ebnf-dd`

### To add new overlays:
1. Create new YAML file in `overlays/`
2. Update Makefile to apply overlay
3. Run build process

## Validation

Specifications are validated using:
```bash
make open-api-spec-lint
```

This ensures:
- Valid OpenAPI 3.0 syntax
- Consistent schemas
- Proper references
- Security definitions

## Integration Points

- **Postman Collections**: Generated from final spec
- **Mock Servers**: Use final spec for response simulation
- **Documentation**: Rendered from final-with-examples spec
- **SDKs**: Generated from final spec

## Related Documentation

- [Data Dictionary](../data_dictionary/README.md) - EBNF source files
- [Postman Directory](../postman/README.md) - Generated collections
- [Scripts Directory](../scripts/README.md) - Conversion tools